{"version":3,"file":"stacked-barchart.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/stacked-barchart/index.js"],"sourcesContent":["import vegaEmbed from \"vega-embed\";\nimport { reduce } from \"vega-lite/build/src/encoding\";\n\nexport default async function stackedBarchart(stanza, params) {\n  let spec = await fetch(params[\"src-url\"]).then((res) => res.json());\n  // spec.data[0].values = [\n  //   {\"category\": \"value1\", \"amount\": 1},\n  //   {\"category\": \"value2\", \"amount\": 7},\n  //   {\"category\": \"value3\", \"amount\": 5},\n  //   {\"category\": \"value4\", \"amount\": 9},\n  // ]\n\n  //stanza（描画範囲）のwidth・height\n  spec.width = params[\"width\"];\n  spec.height = params[\"height\"];\n\n  //stanzaのpadding\n  spec.padding = params[\"padding\"];\n\n  //イベントなど設定できるかと思ったができない\n  // spec.signals[0].on[0].events = \"click\"\n  // spec.signals[0].on[1].events = \"click\"\n\n  //棒・スケールに関する設定\n  spec.scales[0].paddingInner = params[\"padding-inner\"]\n  spec.scales[0].paddingOuter = params[\"padding-outer\"]\n\n  spec.scales[2].range = [\n    'var(--series-0-color)',\n    'var(--series-1-color)',\n    'var(--series-2-color)',\n    'var(--series-3-color)',\n    'var(--series-4-color)',\n    'var(--series-5-color)'\n  ]\n\n  //軸に関する設定\n  spec.axes[0] =\n  {\n    \"scale\": \"x\",\n    \"orient\": params[\"xaxis-orient\"],\n    \"title\": params[\"xaxis-title\"],\n    \"titlePadding\": getComputedStyle(stanza.root.host).getPropertyValue(\"--title-padding\")-0,\n    \"grid\": params[\"xgrid\"] === \"true\",\n    \"gridColor\": \"var(--grid-color)\",\n    \"gridDash\": getComputedStyle(stanza.root.host).getPropertyValue(\"--grid-dash\"),\n    \"gridOpacity\":getComputedStyle(stanza.root.host).getPropertyValue(\"--grid-opacity\"),\n    \"gridWidth\": getComputedStyle(stanza.root.host).getPropertyValue(\"--grid-width\"),\n    \"ticks\": params[\"xtick\"] === \"true\",\n    \"encode\": {\n      \"axis\": {\n        \"update\": {\n        }\n      },\n      \"ticks\": {\n        \"update\": {\n          \"stroke\": {\"value\": \"var(--tick-color)\"},\n        }\n      },\n      \"grids\": {\n        \"update\": {\n          \"zindex\": {\"value\": \"0\"}\n        }\n      },\n      \"labels\": {\n        \"interactive\": true,\n        \"update\": {\n          \"angle\": {\"value\": params[\"xlabel-angle\"]},\n          \"fill\": {\"value\": \"var(--label-color)\"},\n          \"font\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--label-font\")},\n          \"fontSize\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--label-size\")}\n        },\n        \"hover\": {\n          \"fill\": {\"value\": \"var(--emphasized-color)\"}\n        }\n      },\n      \"title\": {\n        \"update\": {\n          \"font\":{\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--label-font\")},\n          \"fontSize\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--title-size\")},\n          \"fontWeight\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--title-weight\")}\n        }\n      },\n      \"domain\": {\n        \"update\": {\n          \"stroke\": {\"value\": \"var(--axis-color)\"},\n          \"strokeWidth\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--axis-width\")},\n          \"zindex\": {\"value\": \"1\"}\n        }\n      }\n    }\n  }\n\n  spec.axes[1] = \n  {\n    \"scale\": \"y\",\n    \"orient\": params[\"yaxis-orient\"],\n    \"title\": params[\"yaxis-title\"],\n    \"titlePadding\": getComputedStyle(stanza.root.host).getPropertyValue(\"--title-padding\")-0,\n    \"grid\": params[\"ygrid\"] === \"true\",\n    \"gridColor\": \"var(--grid-color)\",\n    \"gridDash\": getComputedStyle(stanza.root.host).getPropertyValue(\"--grid-dash\"),\n    \"gridOpacity\": getComputedStyle(stanza.root.host).getPropertyValue(\"--grid-opacity\"),\n    \"gridWidth\": getComputedStyle(stanza.root.host).getPropertyValue(\"--grid-width\"),\n    \"ticks\": params[\"ytick\"] === \"true\",\n    \"encode\": {\n      \"axis\": {\n        \"update\": {\n        }\n      },\n      \"ticks\": {\n        \"update\": {\n          \"stroke\": {\"value\": \"var(--tick-color)\"}\n        }\n      },\n      \"grids\": {\n        \"update\": {\n          \"zindex\": {\"value\": \"0\"}\n        }\n      },\n      \"labels\": {\n        \"interactive\": true,\n        \"update\": {\n          \"angle\": {\"value\": params[\"ylabel-angle\"]},\n          \"fill\": {\"value\": \"var(--label-color)\"},\n          \"font\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--label-font\")},\n          \"fontSize\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--label-size\")}\n        },\n        \"hover\": {\n          \"fill\": {\"value\": \"var(--emphasized-color)\"}\n        }\n      },\n      \"title\": {\n        \"update\": {\n          \"font\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--label-font\")},\n          \"fontSize\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--title-size\")},\n          \"fontWeight\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--title-weight\")}\n        }\n      },\n      \"domain\": {\n        \"update\": {\n          \"stroke\": {\"value\": \"var(--axis-color)\"},\n          \"strokeWidth\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--axis-width\")}\n        }\n      }\n    }\n  }\n\n  //rect（棒）の描画について\n  spec.marks[0].encode ={\n    \"enter\": {\n      \"x\": {\"scale\": \"x\", \"field\": \"x\"},\n      \"width\": {\"scale\": \"x\", \"band\": params[\"bar-width\"]},\n      \"y\": {\"scale\": \"y\", \"field\": \"y0\"},\n      \"y2\": {\"scale\": \"y\", \"field\": \"y1\"},\n      \"fill\": {\"scale\": \"color\", \"field\": \"c\", \"offset\": -1}\n      // \"y\": {\"scale\": \"y\", \"field\": \"amount\"},\n      // \"y2\": {\"scale\": \"y\", \"value\": 0}\n    },\n    \"update\": {\n      \"fill\": {\"scale\": \"color\", \"field\": \"c\"}\n      },\n    \"hover\": {\n      \"fill\": {\"value\": \"var(--emphasized-color)\"}\n    }\n  }\n\n  // spec.marks[1].encode ={\n  //   \"enter\": {\n  //     \"align\": {\"value\": \"center\"},\n  //     \"baseline\": {\"value\": \"bottom\"},\n  //     \"fill\": {\"value\": \"var(--emphasized-color)\"},\n  //     \"font\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--label-font\")},\n  //     \"fontSize\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--fontsize-of-value\")},\n  //     \"fontWeight\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--fontweight-of-value\")}\n  //   },\n  //   \"update\": {\n  //     \"x\": {\"scale\": \"x\", \"signal\": \"tooltip.category\", \"band\": 0.5},\n  //     \"y\": {\"scale\": \"y\", \"signal\": \"tooltip.amount\", \"offset\": -1},\n  //     \"text\": {\"signal\": \"tooltip.amount\"},\n  //     \"fillOpacity\": [\n  //       {\"test\": \"datum === tooltip\", \"value\": 0},\n  //       {\"value\": 1}\n  //     ]\n  //   }\n  // }\n\n  const el = stanza.root.querySelector(\"main\");\n  const opts = {\n    renderer: \"svg\"\n  };\n  await vegaEmbed(el, spec, opts);\n}"],"names":["vegaEmbed"],"mappings":";;;;;AAGe,eAAe,eAAe,CAAC,MAAM,EAAE,MAAM,EAAE;AAC9D,EAAE,IAAI,IAAI,GAAG,MAAM,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,GAAG,KAAK,GAAG,CAAC,IAAI,EAAE,CAAC,CAAC;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,KAAK,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;AAC/B,EAAE,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC,QAAQ,CAAC,CAAC;AACjC;AACA;AACA,EAAE,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC;AACnC;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,YAAY,GAAG,MAAM,CAAC,eAAe,EAAC;AACvD,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,YAAY,GAAG,MAAM,CAAC,eAAe,EAAC;AACvD;AACA,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,GAAG;AACzB,IAAI,uBAAuB;AAC3B,IAAI,uBAAuB;AAC3B,IAAI,uBAAuB;AAC3B,IAAI,uBAAuB;AAC3B,IAAI,uBAAuB;AAC3B,IAAI,uBAAuB;AAC3B,IAAG;AACH;AACA;AACA,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACd,EAAE;AACF,IAAI,OAAO,EAAE,GAAG;AAChB,IAAI,QAAQ,EAAE,MAAM,CAAC,cAAc,CAAC;AACpC,IAAI,OAAO,EAAE,MAAM,CAAC,aAAa,CAAC;AAClC,IAAI,cAAc,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,iBAAiB,CAAC,CAAC,CAAC;AAC5F,IAAI,MAAM,EAAE,MAAM,CAAC,OAAO,CAAC,KAAK,MAAM;AACtC,IAAI,WAAW,EAAE,mBAAmB;AACpC,IAAI,UAAU,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,aAAa,CAAC;AAClF,IAAI,aAAa,CAAC,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,gBAAgB,CAAC;AACvF,IAAI,WAAW,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC;AACpF,IAAI,OAAO,EAAE,MAAM,CAAC,OAAO,CAAC,KAAK,MAAM;AACvC,IAAI,QAAQ,EAAE;AACd,MAAM,MAAM,EAAE;AACd,QAAQ,QAAQ,EAAE;AAClB,SAAS;AACT,OAAO;AACP,MAAM,OAAO,EAAE;AACf,QAAQ,QAAQ,EAAE;AAClB,UAAU,QAAQ,EAAE,CAAC,OAAO,EAAE,mBAAmB,CAAC;AAClD,SAAS;AACT,OAAO;AACP,MAAM,OAAO,EAAE;AACf,QAAQ,QAAQ,EAAE;AAClB,UAAU,QAAQ,EAAE,CAAC,OAAO,EAAE,GAAG,CAAC;AAClC,SAAS;AACT,OAAO;AACP,MAAM,QAAQ,EAAE;AAChB,QAAQ,aAAa,EAAE,IAAI;AAC3B,QAAQ,QAAQ,EAAE;AAClB,UAAU,OAAO,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,cAAc,CAAC,CAAC;AACpD,UAAU,MAAM,EAAE,CAAC,OAAO,EAAE,oBAAoB,CAAC;AACjD,UAAU,MAAM,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;AAChG,UAAU,UAAU,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;AACpG,SAAS;AACT,QAAQ,OAAO,EAAE;AACjB,UAAU,MAAM,EAAE,CAAC,OAAO,EAAE,yBAAyB,CAAC;AACtD,SAAS;AACT,OAAO;AACP,MAAM,OAAO,EAAE;AACf,QAAQ,QAAQ,EAAE;AAClB,UAAU,MAAM,CAAC,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;AAC/F,UAAU,UAAU,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;AACpG,UAAU,YAAY,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,CAAC;AACxG,SAAS;AACT,OAAO;AACP,MAAM,QAAQ,EAAE;AAChB,QAAQ,QAAQ,EAAE;AAClB,UAAU,QAAQ,EAAE,CAAC,OAAO,EAAE,mBAAmB,CAAC;AAClD,UAAU,aAAa,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;AACvG,UAAU,QAAQ,EAAE,CAAC,OAAO,EAAE,GAAG,CAAC;AAClC,SAAS;AACT,OAAO;AACP,KAAK;AACL,IAAG;AACH;AACA,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AACd,EAAE;AACF,IAAI,OAAO,EAAE,GAAG;AAChB,IAAI,QAAQ,EAAE,MAAM,CAAC,cAAc,CAAC;AACpC,IAAI,OAAO,EAAE,MAAM,CAAC,aAAa,CAAC;AAClC,IAAI,cAAc,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,iBAAiB,CAAC,CAAC,CAAC;AAC5F,IAAI,MAAM,EAAE,MAAM,CAAC,OAAO,CAAC,KAAK,MAAM;AACtC,IAAI,WAAW,EAAE,mBAAmB;AACpC,IAAI,UAAU,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,aAAa,CAAC;AAClF,IAAI,aAAa,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,gBAAgB,CAAC;AACxF,IAAI,WAAW,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC;AACpF,IAAI,OAAO,EAAE,MAAM,CAAC,OAAO,CAAC,KAAK,MAAM;AACvC,IAAI,QAAQ,EAAE;AACd,MAAM,MAAM,EAAE;AACd,QAAQ,QAAQ,EAAE;AAClB,SAAS;AACT,OAAO;AACP,MAAM,OAAO,EAAE;AACf,QAAQ,QAAQ,EAAE;AAClB,UAAU,QAAQ,EAAE,CAAC,OAAO,EAAE,mBAAmB,CAAC;AAClD,SAAS;AACT,OAAO;AACP,MAAM,OAAO,EAAE;AACf,QAAQ,QAAQ,EAAE;AAClB,UAAU,QAAQ,EAAE,CAAC,OAAO,EAAE,GAAG,CAAC;AAClC,SAAS;AACT,OAAO;AACP,MAAM,QAAQ,EAAE;AAChB,QAAQ,aAAa,EAAE,IAAI;AAC3B,QAAQ,QAAQ,EAAE;AAClB,UAAU,OAAO,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,cAAc,CAAC,CAAC;AACpD,UAAU,MAAM,EAAE,CAAC,OAAO,EAAE,oBAAoB,CAAC;AACjD,UAAU,MAAM,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;AAChG,UAAU,UAAU,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;AACpG,SAAS;AACT,QAAQ,OAAO,EAAE;AACjB,UAAU,MAAM,EAAE,CAAC,OAAO,EAAE,yBAAyB,CAAC;AACtD,SAAS;AACT,OAAO;AACP,MAAM,OAAO,EAAE;AACf,QAAQ,QAAQ,EAAE;AAClB,UAAU,MAAM,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;AAChG,UAAU,UAAU,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;AACpG,UAAU,YAAY,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,gBAAgB,CAAC,CAAC;AACxG,SAAS;AACT,OAAO;AACP,MAAM,QAAQ,EAAE;AAChB,QAAQ,QAAQ,EAAE;AAClB,UAAU,QAAQ,EAAE,CAAC,OAAO,EAAE,mBAAmB,CAAC;AAClD,UAAU,aAAa,EAAE,CAAC,OAAO,EAAE,gBAAgB,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,gBAAgB,CAAC,cAAc,CAAC,CAAC;AACvG,SAAS;AACT,OAAO;AACP,KAAK;AACL,IAAG;AACH;AACA;AACA,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE;AACxB,IAAI,OAAO,EAAE;AACb,MAAM,GAAG,EAAE,CAAC,OAAO,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,CAAC;AACvC,MAAM,OAAO,EAAE,CAAC,OAAO,EAAE,GAAG,EAAE,MAAM,EAAE,MAAM,CAAC,WAAW,CAAC,CAAC;AAC1D,MAAM,GAAG,EAAE,CAAC,OAAO,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,CAAC;AACxC,MAAM,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,CAAC;AACzC,MAAM,MAAM,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC;AAC5D;AACA;AACA,KAAK;AACL,IAAI,QAAQ,EAAE;AACd,MAAM,MAAM,EAAE,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,CAAC;AAC9C,OAAO;AACP,IAAI,OAAO,EAAE;AACb,MAAM,MAAM,EAAE,CAAC,OAAO,EAAE,yBAAyB,CAAC;AAClD,KAAK;AACL,IAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,MAAM,EAAE,GAAG,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;AAC/C,EAAE,MAAM,IAAI,GAAG;AACf,IAAI,QAAQ,EAAE,KAAK;AACnB,GAAG,CAAC;AACJ,EAAE,MAAMA,KAAS,CAAC,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;AAClC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}