{"version":3,"file":"overview_dev.js","sources":["../../../home/runner/work/metastanza/metastanza/node_modules/d3-selection/src/sourceEvent.js","../../../home/runner/work/metastanza/metastanza/node_modules/d3-selection/src/pointer.js","../../../home/runner/work/metastanza/metastanza/stanzas/overview_dev/index.js"],"sourcesContent":["export default function(event) {\n  let sourceEvent;\n  while (sourceEvent = event.sourceEvent) event = sourceEvent;\n  return event;\n}\n","import sourceEvent from \"./sourceEvent.js\";\n\nexport default function(event, node) {\n  event = sourceEvent(event);\n  if (node === undefined) node = event.currentTarget;\n  if (node) {\n    var svg = node.ownerSVGElement || node;\n    if (svg.createSVGPoint) {\n      var point = svg.createSVGPoint();\n      point.x = event.clientX, point.y = event.clientY;\n      point = point.matrixTransform(node.getScreenCTM().inverse());\n      return [point.x, point.y];\n    }\n    if (node.getBoundingClientRect) {\n      var rect = node.getBoundingClientRect();\n      return [event.clientX - rect.left - node.clientLeft, event.clientY - rect.top - node.clientTop];\n    }\n  }\n  return [event.pageX, event.pageY];\n}\n","import * as d3 from 'd3';\nimport metastanza from '@/lib/metastanza_utils.js';\n\nexport default async function overviewDev(stanza, params) {\n  stanza.render({\n    template: 'stanza.html.hbs',\n    parameters: {\n    }\n  });\n  \n  let apis = JSON.parse(params.apis);\n  if (typeof apis == \"object\") draw(stanza.root.querySelector('#chart'), apis, []);\n}\n\nasync function draw(element, apis, body) {\n  const labelMargin = 100;\n  const width = 700;\n  const height = 50;\n  \n  let dataset = {};\n  for (let api of apis) {\n    dataset[api] = await metastanza.getFormatedJson(api, element, body.join(\"&\"));\n  }\n  \n  // first render\n  if (!element.querySelector(\"div\")) {\n    for (let api of apis) {\n      let div = d3.select(element).append(\"div\").attr(\"id\", api);\n      let svg = div.append(\"svg\").attr(\"width\", width + labelMargin).attr(\"height\", height);\n      svg.append(\"text\").attr(\"x\", 0).attr(\"y\", height / 2).attr(\"alignment-baseline\", \"central\").text(dataset[api].type);\n\n      dataset[api].data = setData(dataset[api].data, width, height, labelMargin);\n\n      svg.attr(\"id\", \"svg_\" + dataset[api].type.replace(/\\s/g, \"_\"));\n      svg.selectAll(\"rect\")\n\t.data(dataset[api].data)\n\t.enter()\n\t.append(\"rect\")\n\t.attr(\"x\", function(d){ return d.barStart }).attr(\"y\", 0)\n\t.attr(\"width\", function(d){ return d.barWidth }).attr(\"height\", height)\n\t.attr(\"id\", function(d){ return d.onclick_list[0].id })\n\t.attr(\"class\", function(d, i){\n\t  if (d.label != \"None\") return \"bar-style-\" + i;\n\t  return \"bar-style-na\";\n\t})\n\t.on(\"mouseover\", function(e, d){\n\t  let rect = this;\n\t  let mouse = d3.pointer(e);\n\t  svg.append(\"text\").attr(\"id\", d.onclick_list[0].id).text(d.label + \": \" + d.count)\n\t    .attr(\"x\", function(d){\n\t      if (mouse[0] > width / 2 + labelMargin) return mouse[0] - 10;\n\t      return mouse[0] + 10;\n\t    })\n\t    .attr(\"y\", height / 2)\n\t    .attr(\"alignment-baseline\", \"central\")\n\t    .attr(\"text-anchor\", function(){\n\t      if (mouse[0] > width / 2 + labelMargin) return \"end\";\n\t    });\n\t})\n\t.on(\"mouseout\", function(e, d){ svg.select(\"text#\" + d.onclick_list[0].id).remove() })\n\t.on(\"click\", async function(e, d){\n\t  body.push(dataset[api].type + \"=\" + d.onclick_list[0].id);\n\t  for (let api of apis) {\n\t    let newData = await metastanza.getFormatedJson(api, element, body.join(\"&\"));\n\t    dataset[api].data = changeData(dataset[api].data, newData.data, width, height, labelMargin);\n\t    let svg = d3.select(element).select(\"#svg_\" + dataset[api].type.replace(/\\s/g, \"_\"));\n\t    svg.selectAll(\"rect\")\n\t      .data(dataset[api].data)\n\t      .transition()\n              .delay(500)\n              .duration(1000)\n\t      .attr(\"x\", function(d){ return d.barStart })\n\t      .attr(\"width\", function(d){ return d.barWidth });\n\t  }\n\t});\n    }\n  }\n\n  function setData(data, width, height, labelMargin){\n    let total = 0;\n    for (let category of data) {\n      total += parseFloat(category.count);\n    }\n    \n    let start = labelMargin;\n    for (let i = 0; i < data.length; i++) {\n      let barWidth =  width * parseFloat(data[i].count) / total;\n      if (data.length - 1 == i) barWidth = width - start + labelMargin;\n      data[i].barStart = start;\n      data[i].barWidth = barWidth;\n      start += barWidth;\n    }\n    data.push({\n      label: \"None\",\n      count: \"0\",\n      barStart: width + labelMargin,\n      barWidth: 0,\n      onclick_list: [{id: \"n-a\"}]\n    });\n    console.log(data);\n    return data;\n  }\n  \n  function changeData(data, newData, width, height, labelMargin){\n    let total = 0;\n    let label2data = {};\n    if (!newData[0]) {\n      newData = [{\n\tlabel: \"None\",\n\tcount: \"1\",\n\tonclick_list: [{id: \"n-a\"}]\n      }];\n    }\n    for (let category of newData) {\n      total += parseFloat(category.count);\n      label2data[category.label] = category;\n    }\n    let start = labelMargin;\n    for (let i = 0; i < data.length; i++) {\n      if (label2data[data[i].label]) data[i] = label2data[data[i].label];\n      else data[i].count = 0;\n      let barWidth =  width * parseFloat(data[i].count) / total;\n      if (data.length - 1 == i) barWidth = width - start + labelMargin;\n      data[i].barStart = start;\n      data[i].barWidth = barWidth;\n      start += barWidth;\n    }\n    console.log(data);\n    return data;\n  }\n}\n"],"names":["d3.select","d3.pointer"],"mappings":"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"}