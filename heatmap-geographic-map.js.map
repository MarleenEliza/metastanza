{"version":3,"file":"heatmap-geographic-map.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/heatmap-geographic-map/index.js"],"sourcesContent":["import Stanza from \"togostanza/stanza\";\nimport vegaEmbed from \"vega-embed\";\n\nexport default class heatmapGeographicMap extends Stanza {\n\n  async render() {\n    const spec = await fetch(\"https://vega.github.io/vega/examples/annual-precipitation.vg.json\").then((res) => res.json());\n\n    spec.width = this.params[\"width\"]; //metadata.jsにパラメータを定義\n    spec.height = this.params[\"height\"];\n\n    spec.data = [\n      {\n        \"name\": \"precipitation\",\n        \"url\": \"https://vega.github.io/vega/data/annual-precip.json\" //一時的にVegaのデータを使用\n      },\n      {\n        \"name\": \"contours\",\n        \"source\": \"precipitation\",\n        \"transform\": [\n          {\n            \"type\": \"isocontour\",\n            \"thresholds\": { \"signal\": \"sequence(step, stop, step)\" }\n          }\n        ]\n      },\n      {\n        \"name\": \"world\",\n        \"url\": \"https://vega.github.io/vega/data/world-110m.json\", //一時的にVegaのデータを使用\n        \"format\": { \"type\": \"topojson\", \"feature\": \"countries\" }\n      }\n    ]\n\n    spec.projections = [\n      {\n        \"name\": \"projection\",\n        \"type\": { \"signal\": \"projection\" },\n        \"scale\": { \"signal\": \"scale\" },\n        \"rotate\": { \"signal\": \"[rotate0, rotate1, rotate2]\" },\n        \"translate\": { \"signal\": \"[width/2, height/2]\" }\n      }\n    ]\n\n    spec.scales = [\n      {\n        \"name\": \"color\",\n        \"type\": \"quantize\",\n        \"domain\": { \"signal\": \"[0, stop]\" },\n        \"range\": { \"scheme\": \"bluepurple\", \"count\": { \"signal\": \"levels\" } }\n      }\n    ],\n\n      spec.marks = [\n        {\n          \"type\": \"shape\",\n          \"clip\": true,\n          \"from\": { \"data\": \"world\" },\n          \"encode\": {\n            \"update\": {\n              \"strokeWidth\": { \"value\": 1 },\n              \"stroke\": { \"value\": \"var(--togostanza-map-border-color)\" },\n              \"fill\": { \"value\": \"var(--togostanza-map-color)\" }\n            }\n          },\n          \"transform\": [\n            {\n              \"type\": \"geoshape\",\n              \"projection\": \"projection\"\n            }\n          ]\n        },\n        {\n          \"type\": \"shape\",\n          \"clip\": true,\n          \"from\": { \"data\": \"contours\" },\n          \"encode\": {\n            \"update\": {\n              \"fill\": { \"scale\": \"color\", \"field\": \"contour.value\" },\n              \"fillOpacity\": { \"signal\": \"opacity\" }\n            }\n          },\n          \"transform\": [\n            {\n              \"type\": \"geoshape\",\n              \"field\": \"datum.contour\",\n              \"projection\": \"projection\"\n            }\n          ]\n        }\n      ]\n\n    spec.legends = [\n      {\n        \"title\": \"Annual Precipitation (mm)\",\n        \"fill\": \"color\",\n        \"orient\": \"bottom\",\n        \"offset\": 5,\n        \"type\": \"gradient\",\n        \"gradientLength\": 300,\n        \"gradientThickness\": 12,\n        \"titlePadding\": 10,\n        \"titleOrient\": \"left\",\n        \"titleAnchor\": \"end\",\n        \"direction\": \"horizontal\"\n      }\n    ]\n\n    const el = this.root.querySelector(\"main\");\n    const opts = {\n      renderer: \"svg\",\n    };\n    await vegaEmbed(el, spec, opts);\n  }\n}"],"names":["vegaEmbed"],"mappings":"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"}