{"version":3,"file":"tree.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/tree/index.js"],"sourcesContent":["import vegaEmbed from \"vega-embed\";\n\nexport default async function tree(stanza, params) {\n  const spec = await fetch(params[\"src-url\"]).then((res) => res.json());\n  spec.data[0].url = \"https://vega.github.io/vega/data/flare.json\";\n\n  //stanza（描画範囲）のwidth・height\n  spec.width = params[\"width\"];\n  spec.height = params[\"height\"];\n\n  //stanzaのpadding\n  spec.padding = params[\"padding\"];\n\n  //scales: カラースキームを指定\n  spec.scales[0].type = \"ordinal\";\n\n  spec.scales[0].range = [\n    \"var(--series-0-color)\",\n    \"var(--series-1-color)\",\n    \"var(--series-2-color)\",\n    \"var(--series-3-color)\",\n    \"var(--series-4-color)\",\n    \"var(--series-5-color)\",\n  ];\n\n  //legendを出す\n  spec.legends = [\n    {\n      fill: \"color\",\n      title: params[\"legend-title\"],\n      titleColor: \"var(--legendtitle-color)\",\n      labelColor: \"var(--legendlabel-color)\",\n      orient: \"top--left\",\n      encode: {\n        title: {\n          update: {\n            font: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--legend-font\"\n              ),\n            },\n            fontSize: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--legendtitle-size\"\n              ),\n            },\n            fontWeight: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--legendtitle-weight\"\n              ),\n            },\n          },\n        },\n        labels: {\n          interactive: true,\n          update: {\n            font: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--legend-font\"\n              ),\n            },\n            fontSize: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--legendlabel-size\"\n              ),\n            },\n          },\n          text: { field: \"value\" },\n        },\n        symbols: {\n          update: {\n            shape: { value: params[\"symbol-shape\"] },\n            stroke: { value: \"var(--stroke-color)\" },\n            strokeWidth: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--stroke-width\"\n              ),\n            },\n            opacity: {\n              value: getComputedStyle(stanza.root.host).getPropertyValue(\n                \"--opacity\"\n              ),\n            },\n          },\n        },\n      },\n    },\n  ];\n\n  spec.title = {\n    text: params[\"figuretitle\"], //\"Title of this figure\",\n    orient: getComputedStyle(stanza.root.host).getPropertyValue(\n      \"--figuretitle-orient\"\n    ),\n    anchor: getComputedStyle(stanza.root.host).getPropertyValue(\n      \"--figuretitle-anchor\"\n    ),\n    color: getComputedStyle(stanza.root.host).getPropertyValue(\"--label-color\"),\n    dx:\n      getComputedStyle(stanza.root.host).getPropertyValue(\n        \"--tree-figuretitle-horizonal-offset\"\n      ) - 0,\n    dy:\n      getComputedStyle(stanza.root.host).getPropertyValue(\n        \"--tree-figuretitle-vertical-offset\"\n      ) - 0,\n    font: getComputedStyle(stanza.root.host).getPropertyValue(\"--label-font\"),\n    fontSize: getComputedStyle(stanza.root.host).getPropertyValue(\n      \"--figuretitle-font-size\"\n    ),\n    fontWeight: getComputedStyle(stanza.root.host).getPropertyValue(\n      \"--figuretitle-font-weight\"\n    ),\n  };\n\n  //marks:描画について\n\n  //（デフォルトのコントローラを削除）\n  for (const signal of spec.signals) {\n    delete signal.bind;\n  }\n\n  spec.marks[0].encode = {\n    update: {\n      path: { field: \"path\" },\n      stroke: { value: \"var(--branch-color)\" },\n    },\n    hover: {\n      stroke: { value: \"var(--emphasized-color)\" },\n    },\n  };\n\n  spec.marks[1].encode = {\n    enter: {\n      size: {\n        value: getComputedStyle(stanza.root.host).getPropertyValue(\n          \"--node-size\"\n        ),\n      },\n      stroke: { value: \"var(--stroke-color)\" },\n    },\n    update: {\n      x: { field: \"x\" },\n      y: { field: \"y\" },\n      fill: { scale: \"color\", field: \"depth\" },\n      stroke: { value: \"var(--stroke-color)\" },\n      strokeWidth: {\n        value: getComputedStyle(stanza.root.host).getPropertyValue(\n          \"--stroke-width\"\n        ),\n      },\n    },\n    hover: {\n      fill: { value: \"var(--emphasized-color)\" },\n      stroke: { value: \"var(--hover-stroke-color)\" },\n      strokeWidth: {\n        value: getComputedStyle(stanza.root.host).getPropertyValue(\n          \"--hover-stroke-width\"\n        ),\n      },\n    },\n  };\n\n  spec.marks[2].encode = {\n    enter: {\n      text: { field: \"name\" },\n      font: {\n        value: getComputedStyle(stanza.root.host).getPropertyValue(\n          \"--label-font\"\n        ),\n      },\n      fontSize: {\n        value: getComputedStyle(stanza.root.host).getPropertyValue(\n          \"--label-size\"\n        ),\n      },\n      baseline: { value: \"middle\" },\n    },\n    update: {\n      x: { field: \"x\" },\n      y: { field: \"y\" },\n      dx: { signal: \"datum.children ? -7 : 7\" },\n      align: { signal: \"datum.children ? 'right' : 'left'\" },\n      opacity: { signal: \"labels ? 1 : 0\" },\n      fill: { value: \"var(--label-color)\" },\n      // hoverした時の文字色が薄い場合は文字にstrokecolorをつけたほうがよいかも？（検討）\n      // \"stroke\": {\"value\": \"\"},\n      // \"strokeWidth\": {\"value\": \"\"}\n      // \"stroke\": {\"value\": \"var(--stroke-color)\"},\n      // \"strokeWidth\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--stroke-width\")}\n    },\n    hover: {\n      fill: { value: \"var(--emphasized-color)\" },\n      // \"stroke\": {\"value\": \"var(--hover-stroke-color)\"},\n      // \"strokeWidth\": {\"value\": \"0.5\"}\n      // \"strokeWidth\": {\"value\": getComputedStyle(stanza.root.host).getPropertyValue(\"--hover-stroke-width\")}\n    },\n  };\n\n  const el = stanza.root.querySelector(\"main\");\n  const opts = {\n    renderer: \"svg\",\n  };\n  await vegaEmbed(el, spec, opts);\n}\n"],"names":["vegaEmbed"],"mappings":"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"}