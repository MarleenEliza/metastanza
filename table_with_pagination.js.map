{"version":3,"file":"table_with_pagination.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/table_with_pagination/index.js"],"sourcesContent":["import metastanza from '@/lib/metastanza_utils.js';\nimport { span } from 'vega';\n\nexport default async function tableWithPagination(stanza, params) {\n\n  stanza.render({\n    template: 'stanza.html.hbs'\n  });\n\n  let formBody = [];\n  for (let key in params) {\n    if(params[key] && key != \"table_data_api\") formBody.push(key + \"=\" + encodeURIComponent(params[key]))\n  }\n\n  let api = params.table_data_api;\n  let element = stanza.root.querySelector('#renderDiv');\n  let dataset = await metastanza.getFormatedJson(api, element, formBody.join(\"&\"));\n  if (typeof dataset == \"object\") draw(dataset, stanza, element);\n}\n\nfunction draw(dataset, stanza, element) {\n  let table = document.createElement(\"table\");\n  let thead = document.createElement(\"thead\");\n  let tbody = document.createElement(\"tbody\");\n  element.appendChild(table);\n  table.appendChild(thead);\n  table.appendChild(tbody);\n\n  let order = [];\n  if (dataset.head.order) {\n    for (let i = 0;  i < dataset.head.order.length; i++) {\n      if (parseInt(dataset.head.order[i]) >= 0) {\n\torder[parseInt(dataset.head.order[i])] = i;\n      }\n    }\n  } else {\n    order = [...Array(dataset.head.vars.length).keys()];\n  }\n\n  let tr = document.createElement(\"tr\");\n  tr.classList.add(\"table-fixed\");\n  thead.appendChild(tr);\n  for(let i of order){\n    let th = document.createElement(\"th\");\n    let span_filter = document.createElement(\"span\");\n    let span_sort = document.createElement(\"span\");\n    let label = dataset.head.vars[i];\n    if (dataset.head.labels) label = dataset.head.labels[i];\n    th.innerHTML = label;\n    span_filter.classList.add(\"icon\", \"filter-icon\");\n    span_sort.setAttribute(\"data-type\", label );\n    span_sort.classList.add(\"icon\", \"sort-icon\");\n    th.appendChild(span_filter);\n    th.appendChild(span_sort);\n    tr.appendChild(th);\n  }\n\n  for(let row of dataset.body){\n    tr = document.createElement(\"tr\");\n    tbody.appendChild(tr);\n    for(let j of order){\n      let td = document.createElement(\"td\");\n      if (dataset.head.href[j]) {\n        let a = document.createElement(\"a\");\n        a.setAttribute(\"href\", row[dataset.head.href[j]].value);\n        a.innerHTML = row[dataset.head.vars[j]].value;\n        td.appendChild(a);\n      } else {\n        td.innerHTML = row[dataset.head.vars[j]].value;\n      }\n      tr.appendChild(td);\n    }\n  }\n\n  var sort = stanza.select(\".sort-icon\");\n  sort.addEventListener(\"click\", function () {\n    console.log(\"クリックされました\");\n  });\n    // bb.onclick = function(){\n    //   alert(\"ボタンが押されました。\")\n    // }\n  // setTimeout(function(){\n  //   const hoge = document.getElementById('sort-icon-id3');\n  //   if(hoge){\n  //     hoge.addEventListener(\"click\", function () {\n  //       console.log(\"クリックされました\");\n  //     });\n  //   }\n  // },5000)\n}\n\n// document.getElementsByClassName(\"sort-icon\").onclick = function(){\n//   console.log(\"クリックされた\");\n// }\n// document.getElementsByClassName(\"sort-icon\").click (function(){\n//   console.log(\"クリックされた\");\n// })\n\n// var bb = document.getElementsByClassName(\"sort-icon\");\n// bb.onclick = function(){\n//   console.log(\"ボタンが押されました\");\n// }\n\n// window.onload = function(){\n//   let bb = document.getElementsByClassName(\"sort-icon\");\n//   bb.addEventListener(\"click\", function(){\n//     console.log(\"ボタンが押されました。\")\n//   });\n// };\n\n\n\n"],"names":[],"mappings":";;;;;AAGe,eAAe,mBAAmB,CAAC,MAAM,EAAE,MAAM,EAAE;AAClE;AACA,EAAE,MAAM,CAAC,MAAM,CAAC;AAChB,IAAI,QAAQ,EAAE,iBAAiB;AAC/B,GAAG,CAAC,CAAC;AACL;AACA,EAAE,IAAI,QAAQ,GAAG,EAAE,CAAC;AACpB,EAAE,KAAK,IAAI,GAAG,IAAI,MAAM,EAAE;AAC1B,IAAI,GAAG,MAAM,CAAC,GAAG,CAAC,IAAI,GAAG,IAAI,gBAAgB,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,GAAG,GAAG,GAAG,kBAAkB,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,EAAC;AACzG,GAAG;AACH;AACA,EAAE,IAAI,GAAG,GAAG,MAAM,CAAC,cAAc,CAAC;AAClC,EAAE,IAAI,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,YAAY,CAAC,CAAC;AACxD,EAAE,IAAI,OAAO,GAAG,MAAM,UAAU,CAAC,eAAe,CAAC,GAAG,EAAE,OAAO,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;AACnF,EAAE,IAAI,OAAO,OAAO,IAAI,QAAQ,EAAE,IAAI,CAAC,OAAO,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC;AACjE,CAAC;AACD;AACA,SAAS,IAAI,CAAC,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE;AACxC,EAAE,IAAI,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;AAC9C,EAAE,IAAI,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;AAC9C,EAAE,IAAI,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;AAC9C,EAAE,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;AAC7B,EAAE,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;AAC3B,EAAE,KAAK,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;AAC3B;AACA,EAAE,IAAI,KAAK,GAAG,EAAE,CAAC;AACjB,EAAE,IAAI,OAAO,CAAC,IAAI,CAAC,KAAK,EAAE;AAC1B,IAAI,KAAK,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;AACzD,MAAM,IAAI,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE;AAChD,CAAC,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;AAC5C,OAAO;AACP,KAAK;AACL,GAAG,MAAM;AACT,IAAI,KAAK,GAAG,CAAC,GAAG,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;AACxD,GAAG;AACH;AACA,EAAE,IAAI,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;AACxC,EAAE,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC,CAAC;AAClC,EAAE,KAAK,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;AACxB,EAAE,IAAI,IAAI,CAAC,IAAI,KAAK,CAAC;AACrB,IAAI,IAAI,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;AAC1C,IAAI,IAAI,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;AACrD,IAAI,IAAI,SAAS,GAAG,QAAQ,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;AACnD,IAAI,IAAI,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;AACrC,IAAI,IAAI,OAAO,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,GAAG,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;AAC5D,IAAI,EAAE,CAAC,SAAS,GAAG,KAAK,CAAC;AACzB,IAAI,WAAW,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC;AACrD,IAAI,SAAS,CAAC,YAAY,CAAC,WAAW,EAAE,KAAK,EAAE,CAAC;AAChD,IAAI,SAAS,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,EAAE,WAAW,CAAC,CAAC;AACjD,IAAI,EAAE,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;AAChC,IAAI,EAAE,CAAC,WAAW,CAAC,SAAS,CAAC,CAAC;AAC9B,IAAI,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;AACvB,GAAG;AACH;AACA,EAAE,IAAI,IAAI,GAAG,IAAI,OAAO,CAAC,IAAI,CAAC;AAC9B,IAAI,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;AACtC,IAAI,KAAK,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;AAC1B,IAAI,IAAI,IAAI,CAAC,IAAI,KAAK,CAAC;AACvB,MAAM,IAAI,EAAE,GAAG,QAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;AAC5C,MAAM,IAAI,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;AAChC,QAAQ,IAAI,CAAC,GAAG,QAAQ,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;AAC5C,QAAQ,CAAC,CAAC,YAAY,CAAC,MAAM,EAAE,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC;AAChE,QAAQ,CAAC,CAAC,SAAS,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;AACtD,QAAQ,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC;AAC1B,OAAO,MAAM;AACb,QAAQ,EAAE,CAAC,SAAS,GAAG,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC;AACvD,OAAO;AACP,MAAM,EAAE,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC;AACzB,KAAK;AACL,GAAG;AACH;AACA,EAAE,IAAI,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;AACzC,EAAE,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,YAAY;AAC7C,IAAI,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;AAC7B,GAAG,CAAC,CAAC;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}