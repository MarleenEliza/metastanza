{"version":3,"file":"three-variables-scatterplot.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/three-variables-scatterplot/index.js"],"sourcesContent":["import vegaEmbed from \"vega-embed\";\nimport loadData from \"@/lib/load-data\";\n\nexport default async function threeVariablesScatterplot(stanza, params) {\n  function css(key) {\n    return getComputedStyle(stanza.root.host).getPropertyValue(key);\n  }\n\n  //width,height,padding\n  const width = Number(params[\"width\"]);\n  const height = Number(params[\"height\"]);\n  const padding = Number(params[\"padding\"]);\n\n  const xVariable = params[\"x-variable\"];\n  const yVariable = params[\"y-variable\"];\n  const zVariable = params[\"z-variable\"];\n\n  const values = await loadData(params[\"data-url\"], params[\"data-type\"]);\n\n  const data = [\n    {\n      name: \"source\",\n      values,\n      transform: [\n        {\n          type: \"filter\",\n          expr: `datum['${xVariable}'] != null && datum['${yVariable}'] != null && datum['${zVariable}'] != null`,\n        },\n      ],\n    },\n  ];\n\n  //scales\n  const scales = [\n    {\n      name: \"x\",\n      type: \"linear\",\n      round: true,\n      nice: true,\n      zero: true,\n      domain: { data: \"source\", field: xVariable },\n      range: \"width\",\n    },\n    {\n      name: \"y\",\n      type: \"linear\",\n      round: true,\n      nice: true,\n      zero: true,\n      domain: { data: \"source\", field: yVariable },\n      range: \"height\",\n    },\n    {\n      name: \"size\",\n      type: \"linear\",\n      round: true,\n      nice: false,\n      zero: true,\n      domain: { data: \"source\", field: zVariable },\n      range: [4, 361],\n    },\n  ];\n\n  //axes\n  const axes = [\n    {\n      scale: \"x\",\n      orient: params[\"xaxis-orient\"],\n      domain: true,\n      domainColor: \"var(--axis-color)\",\n      domainWidth: css(\"--axis-width\"),\n      grid: params[\"xgrid\"] === \"true\",\n      gridColor: \"var(--grid-color)\",\n      gridDash: css(\"--grid-dash\"),\n      gridOpacity: css(\"--grid-opacity\"),\n      gridWidth: css(\"--grid-width\"),\n      ticks: params[\"xtick\"] === \"true\",\n      // tickCount: params[\"xtick-count\"],\n      tickColor: \"var(--tick-color)\",\n      tickSize: css(\"--tick-size\"),\n      tickWidth: css(\"--tick-width\"),\n      title: xVariable,\n      titleColor: \"var(--title-color)\",\n      titleFont: css(\"--font-family\"),\n      titleFontSize: css(\"--title-size\"),\n      titleFontWeight: css(\"--title-weight\"),\n      titlePadding: Number(css(\"--title-padding\")),\n      zindex: 0,\n      encode: {\n        labels: {\n          interactive: true,\n          update: {\n            angle: { value: params[\"xlabel-angle\"] },\n            dx: { value: params[\"xlabel-horizonal-offset\"] },\n            dy: { value: params[\"xlabel-vertical-offset\"] },\n            fill: { value: \"var(--label-color)\" },\n            font: {\n              value: css(\"--font-family\"),\n            },\n            fontSize: {\n              value: css(\"--label-size\"),\n            },\n          },\n        },\n      },\n    },\n    {\n      scale: \"y\",\n      orient: params[\"yaxis-orient\"],\n      domain: true,\n      domainColor: \"var(--axis-color)\",\n      domainWidth: css(\"--axis-width\"),\n      grid: params[\"ygrid\"] === \"true\",\n      gridColor: \"var(--grid-color)\",\n      gridDash: css(\"--grid-dash\"),\n      gridOpacity: css(\"--grid-opacity\"),\n      gridWidth: css(\"--grid-width\"),\n      ticks: params[\"ytick\"] === \"true\",\n      // tickCount: params[\"ytick-count\"],\n      tickColor: \"var(--tick-color)\",\n      tickSize: css(\"--tick-size\"),\n      tickWidth: css(\"--tick-width\"),\n      title: yVariable,\n      titleColor: \"var(--title-color)\",\n      titleFont: css(\"--font-family\"),\n      titleFontSize: css(\"--title-size\"),\n      titleFontWeight: css(\"--title-weight\"),\n      titlePadding: Number(css(\"--title-padding\")),\n      zindex: 0,\n      encode: {\n        labels: {\n          interactive: true,\n          update: {\n            angle: { value: params[\"ylabel-angle\"] },\n            dx: { value: params[\"ylabel-horizonal-offset\"] },\n            dy: { value: params[\"ylabel-vertical-offset\"] },\n            fill: { value: \"var(--label-color)\" },\n            font: {\n              value: css(\"--font-family\"),\n            },\n            fontSize: {\n              value: css(\"--label-size\"),\n            },\n          },\n        },\n      },\n    },\n  ];\n\n  // legend\n  const legends = [\n    {\n      size: \"size\",\n      format: \"s\",\n      title: zVariable,\n      titleColor: \"var(--legendtitle-color)\",\n      titleFont: css(\"--font-family\"),\n      titleFontSize: css(\"--legendtitle-size\"),\n      titleFontWeight: css(\"--legendtitle-weight\"),\n      labelColor: \"var(--legendlabel-color)\",\n      labelFont: css(\"--font-family\"),\n      labelFontSize: css(\"--legendlabel-size\"),\n      symbolType: params[\"symbol-shape\"],\n      symbolFillColor: \"var(--series-0-color)\",\n      symbolStrokeColor: css(\"--stroke-color\"),\n      symbolStrokeWidth: css(\"--stroke-width\"),\n    },\n  ];\n\n  //marks\n  const marks = [\n    {\n      name: \"marks\",\n      type: \"symbol\",\n      from: { data: \"source\" },\n      encode: {\n        update: {\n          x: { scale: \"x\", field: xVariable },\n          y: { scale: \"y\", field: yVariable },\n          shape: { value: params[\"symbol-shape\"] },\n          fill: { value: \"var(--series-0-color)\" },\n          size: { scale: \"size\", field: zVariable },\n          stroke: { value: \"var(--stroke-color)\" },\n          strokeWidth: {\n            value: css(\"--stroke-width\"),\n          },\n          opacity: {\n            value: css(\"--opacity\"),\n          },\n        },\n      },\n    },\n  ];\n\n  const spec = {\n    $schema: \"https://vega.github.io/schema/vega/v5.json\",\n    width,\n    height,\n    padding,\n    data,\n    scales,\n    axes,\n    legends,\n    marks,\n  };\n\n  const el = stanza.root.querySelector(\"main\");\n  const opts = {\n    renderer: \"svg\",\n  };\n  await vegaEmbed(el, spec, opts);\n}\n"],"names":["vegaEmbed"],"mappings":"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"}