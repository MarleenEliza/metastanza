{"version":3,"file":"table-with-scroll.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/table-with-scroll/app.vue","../../../home/runner/work/metastanza/metastanza/stanzas/table-with-scroll/index.js"],"sourcesContent":["<template>\n  <div class=\"tableWrapper\" @scroll=\"handleScroll\">\n    <table v-if=\"state.allRows\">\n      <thead>\n        <tr>\n          <th v-for=\"column in state.columns\" :key=\"column.id\">\n            {{ column.label }}\n          </th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr v-for=\"row in state.allRows\" :key=\"row.id\">\n          <td v-for=\"cell in row\" :key=\"cell.column.id\">\n            <span v-if=\"cell.href\">\n              <a :href=\"cell.href\" target=\"_blank\">{{ cell.value }}</a>\n            </span>\n            <span v-else>\n              {{ cell.value }}\n            </span>\n          </td>\n        </tr>\n        <tr v-if=\"state.isFetchingData\">\n          <td :colspan=\"state.columns.length\" class=\"loadingWrapper\">\n            <div class=\"dotTyping\"></div>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  </div>\n</template>\n\n<script>\nimport { defineComponent, reactive, onMounted } from \"vue\";\n\nimport orderBy from \"lodash.orderby\";\nimport zip from \"lodash.zip\";\n\nimport metadata from \"./metadata.json\";\n\nexport default defineComponent({\n  props: metadata[\"stanza:parameter\"].map((p) => p[\"stanza:key\"]),\n\n  setup(params) {\n    const state = reactive({\n      responseJSON: null, // for download. may consume extra memory\n\n      columns: [],\n      allRows: [],\n\n      offset: 0,\n\n      isFetchingData: false,\n    });\n\n    async function fetchData() {\n      console.log(\"fetchData\");\n      state.isFetchingData = true;\n      const res = await fetch(\n        `${params.table_data_api}&limit=${params.limit}&offset=${state.offset}`\n      );\n      const data = await res.json();\n\n      state.responseJSON = data;\n\n      const { vars, labels, order, href } = data.head;\n\n      const columns = zip(vars, labels, order, href)\n        .map(([_var, label, _order, _href]) => {\n          return {\n            id: _var,\n            label,\n            order: _order,\n            href: _href,\n          };\n        })\n        .filter((column) => column.label !== null);\n\n      state.columns = orderBy(columns, [\"order\"]);\n\n      state.allRows = state.allRows.concat(\n        data.body.map((row) => {\n          return columns.map((column) => {\n            return {\n              column,\n              value: row[column.id].value,\n              href: column.href ? row[column.href].value : null,\n            };\n          });\n        })\n      );\n      state.isFetchingData = false;\n    }\n\n    function handleScroll(e) {\n      if (\n        e.path[0].scrollTop ===\n          e.path[0].firstChild.clientHeight - e.path[0].clientHeight &&\n        !state.isFetchingData\n      ) {\n        state.offset++;\n        fetchData();\n      }\n    }\n\n    onMounted(() => {\n      fetchData();\n    });\n\n    return {\n      state,\n      handleScroll,\n    };\n  },\n});\n</script>\n","import { createApp } from \"vue\";\nimport App from \"./app.vue\";\n\nexport default async function tableWithPagination(stanza, params) {\n  const main = stanza.root.querySelector(\"main\");\n  createApp(App, params).mount(main);\n}\n"],"names":["zip","orderBy","_createVNode","_createBlock","App"],"mappings":"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"}