{"version":3,"file":"piechart.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/piechart/index.js"],"sourcesContent":["import vegaEmbed from \"vega-embed\";\n\nexport default async function piechart(stanza, params) {\n  function css(key) {\n    return getComputedStyle(stanza.root.host).getPropertyValue(key);\n  }\n\n  const vegaJson = await fetch(\n    \"https://vega.github.io/vega/examples/pie-chart.vg.json\"\n  ).then((res) => res.json());\n\n  //width,height,padding\n  const width = Number(params[\"width\"]);\n  const height = Number(params[\"height\"]);\n  const padding = { left: 5, top: 5, right: 150, bottom: 30 };\n\n  //data\n  const labelVariable = params[\"label-variable\"];\n  const valueVariable = params[\"value-variable\"];\n  const data = [\n    {\n      name: \"table\",\n      url: params[\"your-data\"],\n      transform: [\n        {\n          type: \"pie\",\n          field: valueVariable,\n          startAngle: { signal: \"startAngle\" },\n          endAngle: { signal: \"endAngle\" },\n          sort: { signal: \"sort\" },\n        },\n      ],\n    },\n  ];\n\n  // scales(color scheme)\n  const scales = [\n    {\n      name: \"color\",\n      type: \"ordinal\",\n      domain: { data: \"table\", field: labelVariable },\n      range: [\n        \"var(--series-0-color)\",\n        \"var(--series-1-color)\",\n        \"var(--series-2-color)\",\n        \"var(--series-3-color)\",\n        \"var(--series-4-color)\",\n        \"var(--series-5-color)\",\n      ],\n    },\n  ];\n\n  //legend\n  const legends = [\n    {\n      fill: \"color\",\n      orient: \"none\",\n      legendX: \"220\",\n      legendY: \"5\",\n      title: labelVariable,\n      titleColor: \"var(--legendtitle-color)\",\n      titleFont: css(\"--font-family\"),\n      titleFontSize: css(\"--legendtitle-size\"),\n      titleFontWeight: css(\"--legendtitle-weight\"),\n      labelColor: \"var(--legendlabel-color)\",\n      labelFont: css(\"--font-family\"),\n      labelFontSize: css(\"--legendlabel-size\"),\n      symbolType: params[\"symbol-shape\"],\n      symbolStrokeColor: css(\"--stroke-color\"),\n      symbolStrokeWidth: css(\"--stroke-width\"),\n    },\n  ];\n\n  //marks\n  const marks = [\n    {\n      type: \"arc\",\n      from: { data: \"table\" },\n      encode: {\n        enter: {\n          fill: { scale: \"color\", field: labelVariable },\n          x: { signal: \"width / 2\" },\n          y: { signal: \"height / 2\" },\n        },\n        update: {\n          startAngle: { field: \"startAngle\" },\n          endAngle: { field: \"endAngle\" },\n          padAngle: { signal: \"padAngle\" },\n          innerRadius: { signal: \"innerRadius\" },\n          outerRadius: { signal: \"width / 2\" },\n          cornerRadius: { signal: \"cornerRadius\" },\n          fill: { scale: \"color\", field: labelVariable },\n          stroke: { value: \"var(--stroke-color)\" },\n          strokeWidth: { value: \"var(--stroke-width)\" },\n        },\n      },\n    },\n  ];\n\n  const spec = {\n    $schema: \"https://vega.github.io/schema/vega/v5.json\",\n    width,\n    height,\n    padding,\n    autosize: \"none\",\n    signals: vegaJson.signals,\n    data,\n    scales,\n    legends,\n    marks,\n  };\n\n  //delete default controller\n  for (const signal of vegaJson.signals) {\n    delete signal.bind;\n  }\n\n  const el = stanza.root.querySelector(\"main\");\n  const opts = {\n    renderer: \"svg\",\n  };\n  await vegaEmbed(el, spec, opts);\n}\n"],"names":["vegaEmbed"],"mappings":"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"}