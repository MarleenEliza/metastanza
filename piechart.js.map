{"version":3,"file":"piechart.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/piechart/index.js"],"sourcesContent":["import Stanza from \"togostanza/stanza\";\n\nimport vegaEmbed from \"vega-embed\";\nimport loadData from \"@/lib/load-data\";\nimport { appendDlButton } from \"@/lib/metastanza_utils.js\";\n\nexport default class PieChart extends Stanza {\n  async render() {\n    const css = (key) => getComputedStyle(this.element).getPropertyValue(key);\n\n    //width,height,padding\n    const width = params[\"width\"];\n    const height = params[\"height\"];\n    const padding = { left: 0, top: 0, right: 150, bottom: 0 };\n\n    //data\n    const labelVariable = params[\"category\"];\n    const valueVariable = params[\"value\"];\n\n    const values = await loadData(params[\"data-url\"], params[\"data-type\"]);\n\n    const data = [\n      {\n        name: \"table\",\n        values,\n        transform: [\n          {\n            type: \"pie\",\n            field: valueVariable,\n            startAngle: { signal: \"startAngle\" },\n            endAngle: { signal: \"endAngle\" },\n            sort: { signal: \"sort\" },\n          },\n        ],\n      },\n    ];\n\n    const signals = [\n      {\n        \"name\": \"startAngle\", \"value\": 0,\n      },\n      {\n        \"name\": \"endAngle\", \"value\": 6.29,\n      },\n      {\n        \"name\": \"padAngle\", \"value\": 0,\n      },\n      {\n        \"name\": \"innerRadius\", \"value\": 0,\n      },\n      {\n        \"name\": \"cornerRadius\", \"value\": 0,\n      },\n      {\n        \"name\": \"sort\", \"value\": false,\n      }\n    ]\n\n    // scales(color scheme)\n    const scales = [\n      {\n        name: \"color\",\n        type: \"ordinal\",\n        domain: { data: \"table\", field: labelVariable },\n        range: [\n          \"var(--togostanza-series-0-color)\",\n          \"var(--togostanza-series-1-color)\",\n          \"var(--togostanza-series-2-color)\",\n          \"var(--togostanza-series-3-color)\",\n          \"var(--togostanza-series-4-color)\",\n          \"var(--togostanza-series-5-color)\",\n        ],\n      },\n    ];\n\n    //legend\n    const legends = [\n      {\n        fill: \"color\",\n        orient: \"right\",\n        legendY: \"5\",\n        title:\n          params[\"legend-title\"] === \"\" ? labelVariable : params[\"legend-title\"],\n        titleColor: \"var(--togostanza-title-font-color)\",\n        titleFont: css(\"--togostanza-font-family\"),\n        titleFontSize: css(\"--togostanza-title-font-size\"),\n        titleFontWeight: css(\"--togostanza-title-font-weight\"),\n        labelColor: \"var(--togostanza-label-font-color)\",\n        labelFont: css(\"--togostanza-font-family\"),\n        labelFontSize: css(\"--togostanza-label-font-size\"),\n        symbolType: params[\"symbol-shape\"],\n        symbolStrokeColor: css(\"--togostanza-border-color\"),\n        symbolStrokeWidth: css(\"--togostanza-border-width\"),\n      },\n    ];\n\n    //marks\n    const marks = [\n      {\n        type: \"arc\",\n        from: { data: \"table\" },\n        encode: {\n          enter: {\n            fill: { scale: \"color\", field: labelVariable },\n            x: { signal: \"width / 2\" },\n            y: { signal: \"height / 2\" },\n          },\n          update: {\n            startAngle: { field: \"startAngle\" },\n            endAngle: { field: \"endAngle\" },\n            padAngle: { signal: \"padAngle\" },\n            innerRadius: { signal: \"innerRadius\" },\n            outerRadius: { signal: \"width / 2\" },\n            cornerRadius: { signal: \"cornerRadius\" },\n            fill: { scale: \"color\", field: labelVariable },\n            stroke: { value: \"var(--togostanza-border-color)\" },\n            strokeWidth: { value: \"var(--togostanza-border-width)\" },\n          },\n        },\n      },\n    ];\n\n    const spec = {\n      $schema: \"https://vega.github.io/schema/vega/v5.json\",\n      width,\n      height,\n      padding,\n      autosize: \"none\",\n      signals,\n      data,\n      scales,\n      legends: params[\"legend\"] === \"false\" ? [] : legends,\n      marks,\n    };\n\n    const el = stanza.root.querySelector(\"main\");\n    const opts = {\n      renderer: \"svg\",\n    };\n    await vegaEmbed(el, spec, opts);\n\n    const svg = stanza.root.querySelector(\".marks\");\n    svg.style.padding = `${params[\"padding\"]}px`;\n\n    //menu button placement\n    appendDlButton(\n      stanza.root.querySelector(\".chart-wrapper\"),\n      stanza.root.querySelector(\"svg\"),\n      \"piechart\",\n      stanza\n    );\n\n    const menuButton = stanza.root.querySelector(\"#dl_button\");\n    const menuList = stanza.root.querySelector(\"#dl_list\");\n    switch (params[\"metastanza-menu-placement\"]) {\n      case \"top-left\":\n        menuButton.setAttribute(\"class\", \"dl-top-left\");\n        menuList.setAttribute(\"class\", \"dl-top-left\");\n        break;\n      case \"top-right\":\n        menuButton.setAttribute(\"class\", \"dl-top-right\");\n        menuList.setAttribute(\"class\", \"dl-top-right\");\n        break;\n      case \"bottom-left\":\n        menuButton.setAttribute(\"class\", \"dl-bottom-left\");\n        menuList.setAttribute(\"class\", \"dl-bottom-left\");\n        break;\n      case \"bottom-right\":\n        menuButton.setAttribute(\"class\", \"dl-bottom-right\");\n        menuList.setAttribute(\"class\", \"dl-bottom-right\");\n        break;\n      case \"none\":\n        menuButton.setAttribute(\"class\", \"dl-none\");\n        menuList.setAttribute(\"class\", \"dl-none\");\n        break;\n    }\n  }\n}"],"names":["vegaEmbed"],"mappings":"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"}