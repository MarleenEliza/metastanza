{"version":3,"file":"treemap.js","sources":["../../../home/runner/work/metastanza/metastanza/stanzas/treemap/index.js"],"sourcesContent":["import Stanza from \"togostanza/stanza\";\nimport vegaEmbed from \"vega-embed\";\n// import loadData from \"togostanza-utils/load-data\";\nimport {\n  downloadSvgMenuItem,\n  downloadPngMenuItem,\n  appendCustomCss,\n} from \"togostanza-utils\";\n\nexport default class Treemap extends Stanza {\n  //TODO ここのclass名はスタンザ名にする必要があります\n  menu() {\n    return [\n      downloadSvgMenuItem(this, \"tree\"),\n      downloadPngMenuItem(this, \"tree\"),\n    ];\n  }\n\n  async render() {\n    appendCustomCss(this, this.params[\"custom-css-url\"]);\n\n    // const css = (key) => getComputedStyle(this.element).getPropertyValue(key);\n\n    //width,height,padding\n    const width = 960;\n    const height = 500;\n    const padding = 2.5;\n\n    //TODO this.paramsが記載されていながらも、metastanza.jsonに対応する設定の記述がなかったためビルドできていないようでした\n    //TODO こちらの設定は現在は使わないですが、後ほど設定するのでひとまずコメントアウトしております\n    // //data\n    // const labelVariable = this.params[\"label\"]; //\"name\"\n    // const parentVariable = this.params[\"parent-node\"]; //\"parent\"\n    // const idVariable = this.params[\"node\"]; //\"id-variable\"\n\n    // const values = await loadData(\n    //   this.params[\"data-url\"],\n    //   this.params[\"data-type\"]\n    // );\n\n    const signals = [\n      {\n        name: \"layout\",\n        value: \"squarify\",\n        bind: {\n          input: \"select\",\n          options: [\"squarify\", \"binary\", \"slicedice\"],\n        },\n      },\n      {\n        name: \"aspectRatio\",\n        value: \"1.6\",\n        bind: { input: \"range\", min: 1, max: 5, step: 0.1 },\n      },\n    ];\n\n    const data = [\n      {\n        name: \"tree\",\n        // url: \"data/flare.json\", //TODO 相対パスになっています。同ディレクトリ内にデータがない場合は、絶対パスで記述する必要があります。\n        url: \"https://vega.github.io/vega/data/flare.json\", //TODO 絶対パスに変更しました。\n        transform: [\n          {\n            type: \"stratify\",\n            key: \"id\",\n            parentKey: \"parent\",\n          },\n          {\n            type: \"treemap\",\n            field: \"size\",\n            sort: { field: \"value\" },\n            round: true,\n            method: { signal: \"layout\" },\n            ratio: { signal: \"aspectRatio\" },\n            size: [{ signal: \"width\" }, { signal: \"height\" }],\n          },\n        ],\n      },\n      {\n        name: \"nodes\",\n        source: \"tree\",\n        transform: [\n          {\n            type: \"filter\",\n            expr: \"datum.children\",\n          },\n        ],\n      },\n      {\n        name: \"leaves\",\n        source: \"tree\",\n        transform: [\n          {\n            type: \"filter\",\n            expr: \"!datum.children\",\n          },\n        ],\n      },\n    ];\n\n    //scales\n    const scales = [\n      {\n        name: \"color\",\n        type: \"ordinal\",\n        domain: { data: \"nodes\", field: \"name\" },\n        range: [\n          \"#3182bd\",\n          \"#6baed6\",\n          \"#9ecae1\",\n          \"#c6dbef\",\n          \"#e6550d\",\n          \"#fd8d3c\",\n          \"#fdae6b\",\n          \"#fdd0a2\",\n          \"#31a354\",\n          \"#74c476\",\n          \"#a1d99b\",\n          \"#c7e9c0\",\n          \"#756bb1\",\n          \"#9e9ac8\",\n          \"#bcbddc\",\n          \"#dadaeb\",\n          \"#636363\",\n          \"#969696\",\n          \"#bdbdbd\",\n          \"#d9d9d9\",\n        ],\n      },\n      {\n        name: \"size\",\n        type: \"ordinal\",\n        domain: [0, 1, 2, 3],\n        range: [256, 28, 20, 14],\n      },\n      {\n        name: \"opacity\",\n        type: \"ordinal\",\n        domain: [0, 1, 2, 3],\n        range: [0.15, 0.5, 0.8, 1.0],\n      },\n    ];\n\n    //marks\n    const marks = [\n      {\n        type: \"rect\",\n        from: { data: \"nodes\" },\n        interactive: false,\n        encode: {\n          enter: {\n            fill: { scale: \"color\", field: \"name\" },\n          },\n        },\n        update: {\n          x: { field: \"x0\" },\n          y: { field: \"y0\" },\n          x2: { field: \"x1\" },\n          y2: { field: \"y1\" },\n        },\n      },\n      {\n        type: \"rect\",\n        from: { data: \"leaves\" },\n        encode: {\n          enter: {\n            stroke: { value: \"#fff\" },\n          },\n          update: {\n            x: { field: \"x0\" },\n            y: { field: \"y0\" },\n            x2: { field: \"x1\" },\n            y2: { field: \"y1\" },\n            fill: { value: \"transparent\" },\n          },\n          hover: {\n            fill: { value: \"red\" },\n          },\n        },\n      },\n      {\n        type: \"text\",\n        from: { data: \"nodes\" },\n        interactive: false,\n        encode: {\n          enter: {\n            font: { value: \"Helvetica Neue, Arial\" },\n            align: { value: \"center\" },\n            baseline: { value: \"middle\" },\n            fill: { value: \"#000\" },\n            text: { field: \"name\" },\n            fontSize: { scale: \"size\", field: \"depth\" },\n            fillOpacity: { scale: \"opacity\", field: \"depth\" },\n          },\n          update: {\n            x: { signal: \"0.5 * (datum.x0 + datum.x1)\" },\n            y: { signal: \"0.5 * (datum.y0 + datum.y1)\" },\n          },\n        },\n      },\n    ];\n\n    const spec = {\n      $schema: \"https://vega.github.io/schema/vega/v5.json\",\n      width,\n      height,\n      padding,\n      signals,\n      data,\n      scales,\n      marks,\n    };\n\n    const el = this.root.querySelector(\"main\");\n    const opts = {\n      renderer: \"svg\",\n    };\n    await vegaEmbed(el, spec, opts);\n  }\n}\n"],"names":["vegaEmbed"],"mappings":"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"}